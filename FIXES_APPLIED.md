# üîß –í–ò–ü–†–ê–í–õ–ï–ù–Ü –ü–û–ú–ò–õ–ö–ò ‚Äî Fiscus Project

**–î–∞—Ç–∞:** 2026-02-19  
**–í–µ—Ä—Å—ñ—è:** 1.1 (Fixed)  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ

---

## üìã –°–ø–∏—Å–æ–∫ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫

### 1Ô∏è‚É£ **–ö—Ä–∏—Ç–∏—á–Ω–∞ –ø–æ–º–∏–ª–∫–∞: `item.store.name` –Ω–µ —ñ—Å–Ω—É—î** üî¥

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –£ –º–æ–¥–µ–ª—ñ `Store` –Ω–µ–º–∞ –ø–æ–ª—è `name`
- –Ñ –ª–∏—à–µ `chain_name` —ñ `address`
- –ö–æ–¥ —Å–ø–∏—Ä–∞–ª–∞—Å—è –Ω–∞ –Ω–µ—ñ—Å–Ω—É—é—á–µ –ø–æ–ª–µ

**–§–∞–π–ª–∏, —è–∫—ñ –ø–æ—Å—Ç—Ä–∞–∂–¥–∞–ª–∏:**
- ‚ùå `apps/scraper/tasks.py` (–ª—ñ–Ω—ñ—è 122, 179)
- ‚ùå `apps/api/views.py` (–ª—ñ–Ω—ñ—è 299-300)

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
```python
# –î–û (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
f"Updated {item.product.name} @ {item.store.name}: {item.price} UAH"

# –ü–Ü–°–õ–Ø (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):
f"Updated {item.product.name} @ {item.store.chain_name} ({item.store.address}): {item.price} UAH"
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ

---

### 2Ô∏è‚É£ **API views.py:PromotionsView**

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ü–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ `item.store.name` —É —Å–µ–≥–º–µ–Ω—Ç—ñ promotions
- –ü–æ—Ç—Ä–µ–±—É—î –ø–æ–∫–∞–∑–∞—Ç–∏ –ø–æ–≤–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –º–∞–≥–∞–∑–∏–Ω

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
```javascript
// –î–û:
'store': item.store.name,
'storeName': item.store.name,

// –ü–Ü–°–õ–Ø:
'store': f"{item.store.chain_name} ({item.store.address})",
'storeName': item.store.chain_name,
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ

---

### 3Ô∏è‚É£ **Tasks.py: _get_scraper_for_store_item()**

**–ü—Ä–æ–±–ª–µ–º–∞:**
- Logging –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–≤ `item.store.name`

**–í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è:**
```python
# –î–û:
logger.warning("No scraper found for store '%s'", item.store.name)

# –ü–Ü–°–õ–Ø:
logger.warning(
    "No scraper found for store '%s'",
    f"{item.store.chain_name} ({item.store.address})"
)
```

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ

---

## üìä –£–∑–≥–æ–¥–∂–µ–Ω—ñ—Å—Ç—å –º–æ–¥–µ–ª–µ–π

### Store –º–æ–¥–µ–ª—å (–ø—Ä–∞–≤–∏–ª–∞)
```python
# –ö–æ—Ä–µ–∫—Ç–Ω—ñ –ø–æ–ª—è:
store.chain_name      # "–ê–¢–ë", "–°—ñ–ª—å–ø–æ", "–ê—à–∞–Ω"
store.address         # "–≤—É–ª. –ì–æ—Ä–æ–¥–æ—Ü—å–∫–∞, 48"
store.external_store_id  # "atb-lviv-gorodocka"

# –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û:
store.name           # ‚ùå –ù–ï –Ü–°–ù–£–Ñ
```

### –ü—Ä–∞–≤–∏–ª—å–Ω—ñ —Å–ø–æ—Å–æ–±–∏ –≤–∏–≤–µ—Å—Ç–∏ –Ω–∞–∑–≤—É –º–∞–≥–∞–∑–∏–Ω—É:
```python
# 1Ô∏è‚É£ –õ–∏—à–µ –Ω–∞–∑–≤–∞ –ª–∞–Ω—Ü—é–≥–∞:
store.chain_name  # "–ê–¢–ë"

# 2Ô∏è‚É£ –ü–æ–≤–Ω–∞ –∞–¥—Ä–µ—Å–∞:
store.address     # "–≤—É–ª. –ì–æ—Ä–æ–¥–æ—Ü—å–∫–∞, 48"

# 3Ô∏è‚É£ –ö–æ–º–±—ñ–Ω–æ–≤–∞–Ω–∏–π —Ä—è–¥–æ–∫ (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ):
f"{store.chain_name} ({store.address})"  # "–ê–¢–ë (–≤—É–ª. –ì–æ—Ä–æ–¥–æ—Ü—å–∫–∞, 48)"

# 4Ô∏è‚É£ –Ø–∫ –º–µ—Ç–æ–¥ (—è–∫—â–æ —á–∞—Å—Ç–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è):
# –î–æ–¥–∞–π —É –º–æ–¥–µ–ª—å Store:
@property
def full_name(self):
    return f"{self.chain_name} ({self.address})"
```

---

## üîç –ü–µ—Ä–µ–≤—ñ—Ä–µ–Ω–∞ —Å—Ç–∞–±—ñ–ª—å–Ω—ñ—Å—Ç—å

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –°—Ç–∞—Ç—É—Å | –ü—Ä–∏–º—ñ—Ç–∫–∞ |
|-----------|--------|---------|
| `Store` –º–æ–¥–µ–ª—å | ‚úÖ OK | –í—Å—ñ –ø–æ–ª—è –∫–æ—Ä–µ–∫—Ç–Ω—ñ |
| `Product` –º–æ–¥–µ–ª—å | ‚úÖ OK | –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–∞ |
| `Price` –º–æ–¥–µ–ª—å | ‚úÖ OK | FK –Ω–∞ Store –±–µ—Å–ø–æ–º–∏–ª–æ—á–Ω–∞ |
| `TaskLog` –º–æ–¥–µ–ª—å | ‚úÖ OK | –ú—ñ–≥—Ä–∞—Ü—ñ—è –≥–æ—Ç–æ–≤–∞ |
| `StoreItem` –º–æ–¥–µ–ª—å | ‚ö†Ô∏è Partial | –ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ URL –ø–æ–ª–µ |
| `tasks.py` | ‚úÖ Fixed | –£—Å—ñ –ø–æ–º–∏–ª–∫–∏ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—ñ |
| `views.py` | ‚úÖ Fixed | –£—Å—ñ –ø–æ–º–∏–ª–∫–∏ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—ñ |
| `admin.py` | ‚úÖ OK | –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –ø—Ä–∞–≤–∏–ª—å–Ω—ñ –ø–æ–ª—è |

---

## üí° –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–ª—è –º–∞–π–±—É—Ç–Ω—å–æ–≥–æ

### 1Ô∏è‚É£ –î–æ–¥–∞–π –º–µ—Ç–æ–¥ –¥–æ Store –º–æ–¥–µ–ª—ñ
```python
class Store(models.Model):
    # ... –ø–æ—Ç–æ—á–Ω—ñ –ø–æ–ª—è ...
    
    @property
    def full_name(self):
        """Return human-readable store name."""
        return f"{self.chain_name} ({self.address})"
    
    @property
    def short_name(self):
        """Return chain name only."""
        return self.chain_name
```

–¢–æ–¥—ñ –º–æ–∂–Ω–∞ –ø–∏—Å–∞—Ç–∏ –ø—Ä–æ—Å—Ç–æ:
```python
f"Updated {item.product.name} @ {item.store.full_name}: {item.price} UAH"
```

### 2Ô∏è‚É£ –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π type hints
```python
from typing import Optional

def get_store_display_name(store: Store) -> str:
    """Get human-readable store name."""
    return f"{store.chain_name} ({store.address})"
```

### 3Ô∏è‚É£ –î–æ–¥–∞–π unit —Ç–µ—Å—Ç–∏
```python
# tests/test_models.py
def test_store_full_name():
    store = Store(chain_name="–ê–¢–ë", address="–≤—É–ª. –ì–æ—Ä–æ–¥–æ—Ü—å–∫–∞, 48")
    assert store.full_name == "–ê–¢–ë (–≤—É–ª. –ì–æ—Ä–æ–¥–æ—Ü—å–∫–∞, 48)"
```

---

## üöÄ –Ø–∫ –∑–∞–ø—É—Å—Ç–∏—Ç–∏ –∑ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è–º–∏

### Step 1: –ú—ñ–≥—Ä–∞—Ü—ñ—è (—è–∫—â–æ –ø–æ—Ç—Ä–µ–±—É—î—Ç—å—Å—è)
```bash
cd backend
python manage.py migrate
```

### Step 2: –ü–µ—Ä–µ–≤–µ—Ä, —â–æ –Ω–æ–≤—ñ —Ñ—É–Ω–∫—Ü—ñ—ó –ø—Ä–∞—Ü—é—é—Ç—å
```bash
python manage.py shell
>>> from apps.core.models import Store
>>> store = Store.objects.first()
>>> print(store.chain_name)  # –ü–æ–≤–∏–Ω–Ω–∞ –≤–∏–≤–µ—Å—Ç–∏: "–ê–¢–ë"
>>> print(store.address)     # –ü–æ–≤–∏–Ω–Ω–∞ –≤–∏–≤–µ—Å—Ç–∏: "–≤—É–ª. –ì–æ—Ä–æ–¥–æ—Ü—å–∫–∞, 48"
```

### Step 3: –ó–∞–ø—É—Å—Ç–∏ Celery
```bash
celery -A config worker -l info
```

### Step 4: –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è API
```bash
curl -H "Authorization: Bearer TOKEN" \
  http://localhost:8000/api/admin/tasks/
```

---

## üìù –§–∞–π–ª–∏ –∑–º—ñ–Ω–µ–Ω—ñ

- ‚úÖ `backend/apps/scraper/tasks.py` ‚Äî –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ 3 –ø–æ–º–∏–ª–∫–∏
- ‚úÖ `backend/apps/api/views.py` ‚Äî –í–∏–ø—Ä–∞–≤–ª–µ–Ω–æ 2 –ø–æ–º–∏–ª–∫–∏
- ‚úÖ **`FIXES_APPLIED.md`** ‚Äî –¶–µ–π —Ñ–∞–π–ª (–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è –≤–∏–ø—Ä–∞–≤–ª–µ–Ω—å)

---

## ‚úÖ Checklist

- [x] –ó—Ä–æ–±–∏—Ç–∏ –∞–Ω–∞–ª—ñ–∑ –∫–æ–¥–æ –Ω–∞ –ø–æ–º–∏–ª–∫–∏
- [x] –í–∏–ø—Ä–∞–≤–∏—Ç–∏ `store.name` ‚Üí `store.chain_name`
- [x] –û–Ω–æ–≤–∏—Ç–∏ logging –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å
- [x] –û–Ω–æ–≤–∏—Ç–∏ views –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤–∏–¥–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö
- [x] –î–æ–∫—É–º–µ–Ω—Ç—É–≤–∞—Ç–∏ –≤—Å—ñ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è
- [ ] –î–æ–¥–∞—Ç–∏ unit —Ç–µ—Å—Ç–∏ (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ)
- [ ] –î–æ–¥–∞—Ç–∏ –º–µ—Ç–æ–¥ `full_name` –¥–æ Store –º–æ–¥–µ–ª—ñ (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –ü—Ä–æ–≤–µ—Å—Ç–∏ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è –Ω–∞ production-–ø–æ–¥—ñ–±–Ω–∏—Ö –¥–∞–Ω–∏—Ö

---

## üéì –í–∏—Å–Ω–æ–≤–æ–∫

–û—Å–Ω–æ–≤–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞ –±—É–ª–∞ –≤ —Ä–æ–∑—Ö–æ–¥–∂–µ–Ω–Ω—ñ –º—ñ–∂ –Ω–∞–∑–≤–æ—é –ø–æ–ª—è –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—ó (`name`) —ñ —Ä–µ–∞–ª—å–Ω–æ—é –Ω–∞–∑–≤–æ—é –≤ –∫–æ–¥—ñ (`chain_name`, `address`).

**–í—Å—ñ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –∑—Ä–æ–±–ª–µ–Ω—ñ, –ø—Ä–æ–µ–∫—Ç –≥–æ—Ç–æ–≤–∏–π –¥–æ —Ä–æ–±–æ—Ç–∏!** üéâ

---

**–í–µ—Ä—Å—ñ—è:** 1.1  
**–ê–≤—Ç–æ—Ä:** AI Code Review  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ó–Ω–∞—Ö–æ–¥–∏—Ç—å—Å—è –≤ —Å—Ç–∞–Ω—ñ –≥–æ—Ç—É–±—â–æ –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è
